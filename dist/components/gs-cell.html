<link rel="import" href="gs-stone.html">
<dom-module id="gs-cell">
  <template>
    <style>
      .pointer {
        cursor: pointer;
      }

      .unselectable {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .gh {
        /* position of the header in the board */
        background: #dd8;
        outline: 3px solid #CC0000;
      }

      table.gc {
        /* cell table */
        border-style: none;
        border: solid black 0px;
      }

      .gc tr {
        border-style: none;
        border: 0px;
      }

      .gc td {
        border-style: none;
        border: solid black 0px;
        width: 15px;
        height: 15px;
        text-align: center;
        color: #F3F3E9;
      }

      .gc td div {
        line-height: 2;
      }

      /*# sourceMappingURL=style.css.map */

    </style>

    <template is="dom-if" if="true">
      <!-- // ^ (otherwise, the cssClass() does not refresh itself) -->
      <div class$="gc {{cssClass(header)}}">
        <table>
          <tbody>
            <tr>
              <td>
                <gs-stone color="blue" amount="{{cell.blue}}" options="{{options}}"></gs-stone>
              </td>
              <td>
                <gs-stone color="black" amount="{{cell.black}}" options="{{options}}"></gs-stone>
              </td>
            </tr>
            <tr>
              <td>
                <gs-stone color="red" amount="{{cell.red}}" options="{{options}}"></gs-stone>
              </td>
              <td>
                <gs-stone color="green" amount="{{cell.green}}" options="{{options}}"></gs-stone>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </template>

  </template>
  <script>
    Polymer({
      is: 'gs-cell',
      properties: {
        cellIndex: Number,
        rowIndex: Number,
        cell: Object,
        table: Array,
        header: {
          type: Object,
          notify: true
        },
        options: Object
      },
      listeners: {
        click: '_leftClick'
      },
      ready: function() {
        return this._validateData();
      },
      cssClass: function(header) {
        var theHeaderIsHere;
        if (header == null) {
          return "";
        }
        theHeaderIsHere = this.x() === header.x && this.y() === header.y;
        if (theHeaderIsHere) {
          return "gh";
        } else {
          return "";
        }
      },
      x: function() {
        return this.cellIndex;
      },
      y: function() {
        return this.getRowNumber(this.rowIndex);
      },
      getRowNumber: function(rowIndex) {
        return this.table.length - 1 - rowIndex;
      },
      _leftClick: function(event) {
        if (!this.options.editable) {
          return;
        }
        if (this.domHost.isCtrlPressed()) {
          return this.header = {
            x: this.x(),
            y: this.y()
          };
        }
      },
      _validateData: function() {
        if (this.table == null) {
          throw new Error("The table is required");
        }
        if (this.header == null) {
          throw new Error("The header is required");
        }
        if (this.options == null) {
          throw new Error("The options are required");
        }
        if (this.cell == null) {
          throw new Error("The cell is required");
        }
        if ((this.cellIndex == null) || (this.rowIndex == null)) {
          throw new Error("The coordinates are required");
        }
      }
    });

  </script>
</dom-module>