<dom-module id="gs-common">
  <template>
    <style>
      
    </style>


  </template>
  <script>
    Polymer({
      is: 'gs-common'
    });

    Polymer({
      is: 'dom-iterate',
      "extends": 'template',
      _template: null,
      properties: {
        from: {
          type: Number,
          value: 0
        },
        to: {
          type: Number,
          value: 0
        },
        count: {
          type: Number,
          observer: '_countChanged'
        }
      },
      observers: ['_repeat_changed(from, to)'],
      behaviors: [Polymer.Templatizer],
      created: function() {
        return this._instances = [];
      },
      ready: function() {
        this._instanceProps = {
          __key__: true
        };
        this._instanceProps['indice'] = true;
        console.log('ready');
        if (!this.ctor) {
          return this.templatize(this);
        }
      },
      render: function() {
        return this._flushTemplates();
      },
      attached: function() {
        var instance, parent, _results;
        parent = this._getParentElement();
        _results = [];
        for (instance in this._instances) {
          _results.push(this._attachInstance(instance, parent));
        }
        return _results;
      },
      detached: function() {
        var instance, _results;
        _results = [];
        for (instance in this._instances) {
          _results.push(this._detachInstance(instance));
        }
        return _results;
      },
      _attachInstance: function(instance, parent) {
        parent = parent || this._getParentElement();
        return this._insertBefore(instance, {
          parent: parent
        });
      },
      _insertBefore: function(instance, target) {
        var before, parent;
        target = target || {};
        parent = target.parent || this._getParentElement();
        before = target.before || this;
        parent.insertBefore(instance.root, before);
        return instance;
      },
      _detachInstance: function(instance) {
        var child, _results;
        _results = [];
        for (child in instance._children) {
          _results.push(Polymer.dom(instance.root).appendChild(child));
        }
        return _results;
      },
      _getParentElement: function() {
        var parentNode;
        parentNode = Polymer.dom(this).parentNode;
        return Polymer.dom(parentNode);
      },
      _repeat_changed: function(from, to) {
        return console.log('repeat-change');
      },
      _countChanged: function(count, oldValue) {
        return this._debounceTemplate(function() {
          oldValue = oldValue || 0;
          if (count < oldValue) {
            return this._detachInstances(count);
          } else {
            return this._insertItems(count - oldValue, oldValue);
          }
        });
      },
      _detachInstances: function(start, count) {
        var instances, self;
        start = start || 0;
        count = count || this._instances.length - start;
        instances = this._instances.splice(start, count);
        self = this;
        return instances.map(function(inst) {
          return self._detachInstance(inst);
        });
      },
      _insertItems: function(count, startIndex) {
        var before, beforeRow, include_last, index, instance, instances, model, parent, self, _i, _ref, _ref1;
        startIndex = startIndex || 0;
        parent = this._getParentElement();
        if (startIndex === this._instances.length) {
          before = this;
        } else {
          beforeRow = this._instances[startIndex];
          before = beforeRow._children[0];
        }
        self = this;
        if (this.from > this.to) {
          include_last = -1;
        } else {
          include_last = +1;
        }
        for (index = _i = _ref = this.from, _ref1 = this.to + include_last; _ref <= _ref1 ? _i < _ref1 : _i > _ref1; index = _ref <= _ref1 ? ++_i : --_i) {
          model = '';
          instance = '';
          console.log(index);
        }
        return instances = Array.from({
          length: count
        }).map(function(value, i) {
          return {
            indice: i
          };
        }).map(function(model) {
          return new self.ctor(model, self);
        }).map(function(instance) {
          return self._insertBefore(instance, {
            parent: parent,
            before: before
          });
        });
      }
    });


    /*
    _showHideChildren: (hidden)->
      for instance of @._instances
        instance._showHideChildren(hidden)
     */

  </script>
</dom-module>