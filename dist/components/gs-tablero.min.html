<link rel="import" href="../../../gs-common/dist/components/dom-iterate.html"><link rel="import" href="../../../iron-icon/iron-icon.html"><link rel="import" href="../../../iron-icons/iron-icons.html"><link rel="import" href="../../../paper-item/paper-item.html"><link rel="import" href="../../../paper-menu/paper-menu.html"><link rel="import" href="../../../paper-button/paper-button.html"><link rel="import" href="../../../paper-icon-button/paper-icon-button.html"><link rel="import" href="../../../paper-menu-button/paper-menu-button.html"><link rel="import" href="gs-fila.min.html"><link rel="import" href="rule/gs-h-rule-index.min.html"><link rel="import" href="rule/gs-v-rule-index.min.html"><dom-module id="gs-tablero"><template><style>:host{display:block;overflow:hidden;height:100%;width:100%;position:relative;background-color:#fff;background-image:url("../assets/background-widget.png")}:host>.top,:host>.bottom{display:block;height:30px;width:100%;position:absolute}:host>.top>.center,:host>.bottom>.center{position:absolute;top:0;left:30px;width:100%;padding-right:60px;box-sizing:border-box;height:30px;background-color:#cee9f2;overflow:hidden}:host>.top>.left,:host>.top>.right,:host>.bottom>.left,:host>.bottom>.right{top:0;height:30px;width:30px;background-color:#FFF;color:white;position:absolute;background-color:#d9f5ff}:host>.top>.left,:host>.bottom>.left{left:0}:host>.top>.right,:host>.bottom>.right{right:0}:host>.top{top:0}:host>.bottom{bottom:0}:host>.center{height:100%;padding:30px;box-sizing:border-box}:host>.center>.left,:host>.center>.right{top:30px;width:30px;padding-bottom:60px;height:100%;position:absolute;background-color:#cee9f2}:host>.center>.left{left:0}:host>.center>.right{right:0}:host>.center>.content{height:100%;width:100%;overflow:hidden}:host>.center>.content>.viewport{display:inline-block}:host #ruleTop,:host #ruleBottom{display:inline-flex}:host .column-index-bottom,:host .column-index-top,:host .row-index-left,:host .row-index-right{font-size:16px;background-color:#fff;display:block}:host .row-index-left,:host .row-index-right{overflow:hidden;box-sizing:content-box;height:30px;padding-top:10px;margin-top:4px;width:17px}:host .row-index-right{float:left;margin-left:2px;text-align:left;padding-left:10px}:host .row-index-left{float:right;margin-right:2px;padding-right:10px;text-align:right}:host .column-index-bottom,:host .column-index-top{float:left;width:40px;height:27px;margin-left:4px;justify-content:center;display:flex}:host .column-index-bottom{align-items:flex-start;padding-top:2px;margin-top:2px}:host .column-index-top{align-items:flex-end;padding-bottom:1px;margin-top:1px}:host .compass{background-image:url("../assets/compass.png");background-size:80% 80%;background-position:center center;background-repeat:no-repeat;transition:all .2s ease-in-out}:host .compass:hover{border-left:1px solid #cee9f2;border-bottom:1px solid #cee9f2;transform:scale(3) translate(-33%, 33%)}.options{color:#BDB76B;width:100%;height:100%;padding:0}.options paper-button{width:100%;height:100%;position:absolute;padding:0;min-width:0;margin:0;box-shadow:none}.options paper-button iron-icon{margin:10%;width:80%;height:80%}.options paper-button iron-icon:hover{margin:0;width:100%;height:100%}</style><div class="center"><div class="left"><div id="ruleLeft"><template is="dom-iterate" from="{{lastIndex}}" to="0" include-last="true" index-as="rowIndex"><gs-v-rule-index class="row-index-left" rule-index="{{rowIndex}}" zoom="{{zoom}}"></gs-v-rule-index></template></div></div><div class="content" id="screen"><div id="viewport" class="viewport"><template is="dom-repeat" items="{{rows}}" as="row" index-as="rowIndex"><gs-fila row="{{row}}" row-index="{{row.reverseIndex}}" rows-amount="{{rows.length}}" column-amount="{{columnAmount}}" editable="{{editable}}"></gs-fila></template></div></div><div class="right"><div id="ruleRight"><template is="dom-iterate" from="{{lastIndex}}" to="0" include-last="true" index-as="rowIndex"><gs-v-rule-index class="row-index-right" rule-index="{{rowIndex}}" zoom="{{zoom}}"></gs-v-rule-index></template></div></div></div><div class="top"><div class="left"><paper-menu-button class="options"><paper-button class="dropdown-trigger" raised><iron-icon icon="menu"></iron-icon></paper-button><paper-menu class="dropdown-content"><paper-item>centrar tablero</paper-item><paper-item>guardar como</paper-item><paper-item>...</paper-item></paper-menu></paper-menu-button></div><div class="center"><div id="ruleTop"><template is="dom-iterate" from="0" to="{{columnAmount}}" include-last="false" index-as="columnIndex"><gs-h-rule-index class="column-index-top" rule-index="{{columnIndex}}" zoom="{{zoom}}"></gs-h-rule-index></template></div></div><div class="right compass"></div></div><div class="bottom"><div class="left"></div><div class="center"><div id="ruleBottom"><template is="dom-iterate" from="0" to="{{columnAmount}}" include-last="false" index-as="columnIndex"><gs-h-rule-index class="column-index-bottom" rule-index="{{columnIndex}}" zoom="{{zoom}}"></gs-h-rule-index></template></div></div><div class="right"></div></div></template><script>Polymer({is:"gs-tablero",properties:{board:{type:Array,observer:"_reverse"},rows:{type:Array,observer:"_update"},columnAmount:{type:Number},lastIndex:{type:Number},editable:{type:Object,value:!1},panelHeight:{type:Number,observer:"_panel_height_change"},positionX:{type:Number,value:0},positionY:{type:Number,value:0},zoom:{type:Number,value:100}},_generate_empty_row:function(){var a,b,c;for(c=[],a=b=0;8>b;a=++b)c.push({});return c},_generate_empty_rows:function(){var a,b,c;for(c=[],a=b=0;8>b;a=++b)c.push(this._generate_empty_row());return c},get_screen_pos:function(){var a,b;for(b={x:-window.scrollX,y:-window.scrollY},a=this.screen;a;)b.x+=a.offsetLeft,b.y+=a.offsetTop,a=a.offsetParent;return b},_make_zoom_aux:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return r=this.viewport.clientWidth,o=this.viewport.clientHeight,l=this.get_screen_pos(),j=a.clientX-l.x,k=a.clientY-l.y,c=this.zoom/b,m=r*b/200,n=o*b/200,p=j-this.positionX,q=k-this.positionY,h=m-p,i=n-q,f=h*c,g=i*c,d=j+f,e=k+g,this.positionX=d-r*this.zoom/200,this.positionY=e-o*this.zoom/200,this._render()},normalize_delta:function(a){var b;return b=0,"wheelDelta"in a?b=-a.wheelDelta/120:"wheelDeltaY"in a?b=-a.wheelDeltaY/120:"detail"in a&&(b=a.detail/3),b},_make_zoom:function(a){var b,c,d,e,f;return a.preventDefault(),b=400,c=35,d=1.2,f=this.zoom,e=this.normalize_delta(a),0>e?(this.zoom*=-e*d,this.zoom>b&&(this.zoom=b)):e>0&&(this.zoom/=e*d,this.zoom<c&&(this.zoom=c)),f!==this.zoom?this._make_zoom_aux(a,f):void 0},bind_mouse:function(){var a,b,c,d;for(d=["mousewheel","DOMMouseScroll","onmousewheel"],b=0,c=d.length;c>b;b++)a=d[b],this.listen(this,a,"_make_zoom");return this.listen(this.screen,"mousedown","_begin_move")},ready:function(){return this.board=this.board||this._generate_empty_rows(),this.viewport=this.$.viewport,this.screen=this.$.screen,this.ruleLeft=this.$.ruleLeft,this.ruleRight=this.$.ruleRight,this.ruleTop=this.$.ruleTop,this.ruleBottom=this.$.ruleBottom,this.bind_mouse(),this._reverse()},_sanitize_rows:function(){},_reverse:function(){var a,b,c,d,e;for(this.board=this.board||[],c=this.board.slice().reverse(),b=c.length-1,d=0,e=c.length;e>d;d++)a=c[d],a.reverseIndex=b--;return this.set("rows",c)},attached:function(){return this.has_been_attached=!0,this.zoom=100,this._render()},_update:function(){var a,b,c,d;for(this.columnAmount=0,d=this.rows,b=0,c=d.length;c>b;b++)a=d[b],a.length>this.columnAmount&&(this.columnAmount=a.length);return this.lastIndex=this.rows.length-1,this._sanitize_rows(),this._render()},_render:function(){var a,b,c,d,e,f,g;return this.has_been_attached?(g=this.zoom/100,window.chrome&&window.chrome.webstore?(c=this.positionX/g,d=this.positionY/g,this.viewport.style.transform="translate3d("+c+"px,"+d+"px,0)",this.viewport.style.zoom=g):(e=this.viewport.clientHeight,f=this.viewport.clientWidth,a=(f-f*g)/2,b=(e-e*g)/2,c=(this.positionX-a)/g,d=(this.positionY-b)/g,this.viewport.style.transform="scale("+g+") translate3d("+c+"px,"+d+"px,0)"),this.ruleTop.style.marginLeft=this.ruleBottom.style.marginLeft=this.positionX+"px",this.ruleLeft.style.marginTop=this.ruleRight.style.marginTop=this.positionY+"px"):void 0},_begin_move:function(a){var b,c,d;if(1===a.which)return a.cancelBubble=!0,a.preventDefault(),b={item:this},c=function(a){return function(c){return c.cancelBubble=!0,c.preventDefault(),a.make_move(b,c)}}(this),d=function(a){return function(e){return 1===e.which?(e.cancelBubble=!0,e.preventDefault(),a.finish_move(b,e),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)):void 0}}(this),window.addEventListener("mouseup",d),window.addEventListener("mousemove",c),this.init_move(b,a)},init_move:function(a,b){return a.initial_x=this.positionX,a.initial_y=this.positionY,a.initial_mouse_x=b.clientX,a.initial_mouse_y=b.clientY},make_move:function(a,b){return this.positionX=a.initial_x+b.clientX-a.initial_mouse_x,this.positionY=a.initial_y+b.clientY-a.initial_mouse_y,this._render()},finish_move:function(a,b){},_panel_height_change:function(){}});</script></dom-module>