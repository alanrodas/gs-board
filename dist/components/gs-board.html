<link rel="import" href="gs-stone.html">
<dom-module id="gs-board">
  <template>
    <style>
      table.gbs_board {
        border-style: none;
        border: solid black 0px;
        border-spacing: 0;
        border-collapse: collapse;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 9pt;
        display: inline-block;
        vertical-align: top;
      }

      .gbs_board td {
        margin: 0;
        padding: 2px;
        border: solid #888 1px;
        width: 30px;
        height: 30px;
      }

      .gbs_board td.gh {
        /* position of the header in the board */
        margin: 0;
        padding: 2px;
        border: solid #CC0000 3px;
        background: #dd8;
        width: 30px;
        height: 30px;
      }

      .gbs_board td.lv {
        /* labels at the side */
        text-align: center;
        vertical-align: middle;
        border-style: none;
        border: solid black 0px;
        background: #ddd;
        width: 15px;
      }

      .gbs_board td.lh {
        /* labels at the top / bottom */
        text-align: center;
        vertical-align: middle;
        border-style: none;
        border: solid black 0px;
        background: #ddd;
        height: 15px;
      }

      .gbs_board td.lx {
        /* corner */
        border-style: none;
        border: solid black 0px;
        background: #ddd;
        width: 15px;
        height: 15px;
      }

      .gbs_board td.top_left {
        -webkit-border-top-left-radius: 10px;
        -moz-border-top-left-radius: 10px;
        border-top-left-radius: 10px;
      }

      .gbs_board td.top_right {
        -webkit-border-top-right-radius: 10px;
        -moz-border-top-right-radius: 10px;
        border-top-right-radius: 10px;
      }

      .gbs_board td.bottom_left {
        -webkit-border-bottom-left-radius: 10px;
        -moz-border-bottom-left-radius: 10px;
        border-bottom-left-radius: 10px;
      }

      .gbs_board td.bottom_right {
        -webkit-border-bottom-right-radius: 10px;
        -moz-border-bottom-right-radius: 10px;
        border-bottom-right-radius: 10px;
      }

      .gbs_board table.gc {
        /* cell table */
        border-style: none;
        border: solid black 0px;
      }

      .gbs_board .gc tr {
        border-style: none;
        border: 0px;
      }

      .gbs_board .gc td {
        border-style: none;
        border: solid black 0px;
        width: 15px;
        height: 15px;
        text-align: center;
        color: #F3F3E9;
      }

      .gbs_board .gc td div {
        line-height: 2;
      }

      .gbs_board div.A {
        background: #0A37D0;
        border: solid 1px #008;
      }

      .gbs_board div.N {
        background: #040928;
        border: solid 1px #222;
      }

      .gbs_board div.R {
        background: #A60000;
        border: solid 1px #800;
      }

      .gbs_board div.V {
        background: #0B6600;
        border: solid 1px #080;
      }

      .gbs_board div.O {
        width: 20px;
        height: 20px;
        background: none;
      }

      /* empty */
      /* .gbs_stone { ... } */
      .pointer {
        cursor: pointer;
      }

      .unselectable, .gbs_stone {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .gbs_stone {
        font-weight: bold;
        font-size: 8pt;
        width: 20px;
        height: 20px;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        padding: 1px 1px 1px 1px;
      }

      .stone_amount {
        vertical-align: sub;
      }

      /*# sourceMappingURL=style.css.map */

    </style>

    <table class="gbs_board">
      <tbody>
        <tr>
          <td class="lx top_left"></td>
          <template is="dom-repeat" items="{{columnIndexes(board)}}" as="columnIndex">
            <td class="lh">{{columnIndex}}</td>
          </template>
          <td class="lx top_right"></td>
        </tr>
        <template is="dom-repeat" items="{{board}}" as="row" index-as="rowIndex">
          <tr>
            <td class="lv">{{getRowNumber(rowIndex)}}</td>
            <template is="dom-repeat" items="{{row}}" as="cell" index-as="cellIndex">
              <td class$="gc {{headerCssClassFor(rowIndex, cellIndex)}}">
                <table>
                  <tbody>
                    <tr>
                      <td>
                        <gs-stone color="blue" amount="{{cell.blue}}" options="{{options}}"></gs-stone>
                      </td>
                      <td>
                        <gs-stone color="black" amount="{{cell.black}}" options="{{options}}"></gs-stone>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <gs-stone color="red" amount="{{cell.red}}" options="{{options}}"></gs-stone>
                      </td>
                      <td>
                        <gs-stone color="green" amount="{{cell.green}}" options="{{options}}"></gs-stone>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </template>
            <td class="lv">{{getRowNumber(rowIndex)}}</td>
          </tr>
        </template>
        <tr>
          <td class="lx bottom_left"></td>
          <template is="dom-repeat" items="{{columnIndexes(board)}}" as="columnIndex">
            <td class="lh">{{columnIndex}}</td>
          </template>
          <td class="lx bottom_right"></td>
        </tr>
      </tbody>
    </table>

  </template>
  <script>
    Polymer({
      is: 'gs-board',
      properties: {
        board: Array,
        size: {
          type: Object,
          value: {
            x: 2,
            y: 2
          }
        },
        header: {
          type: Object,
          value: {
            x: 0,
            y: 0
          }
        },
        options: Object
      },
      ready: function() {
        this._initializeBoard();
        return this._initializeOptions();
      },
      getRowNumber: function(rowIndex) {
        return this.board.length - 1 - rowIndex;
      },
      columnIndexes: function(board) {
        var _i, _ref, _results;
        return (function() {
          _results = [];
          for (var _i = 0, _ref = board != null ? board[0].length : void 0; 0 <= _ref ? _i < _ref : _i > _ref; 0 <= _ref ? _i++ : _i--){ _results.push(_i); }
          return _results;
        }).apply(this);
      },
      headerCssClassFor: function(rowIndex, cellIndex) {
        var rowNumber;
        rowNumber = this.getRowNumber(rowIndex);
        if (rowNumber === this.header.y && cellIndex === this.header.x) {
          return "gh";
        } else {
          return "";
        }
      },
      _initializeBoard: function() {
        var i, j;
        return this.board != null ? this.board : this.board = (function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = 1, _ref = this.size.y; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
            _results.push((function() {
              var _j, _ref1, _results1;
              _results1 = [];
              for (j = _j = 1, _ref1 = this.size.x; 1 <= _ref1 ? _j <= _ref1 : _j >= _ref1; j = 1 <= _ref1 ? ++_j : --_j) {
                _results1.push({});
              }
              return _results1;
            }).call(this));
          }
          return _results;
        }).call(this);
      },
      _initializeOptions: function() {
        var _base;
        if (this.options == null) {
          this.options = {};
        }
        return (_base = this.options).editable != null ? _base.editable : _base.editable = false;
      }
    });

  </script>
</dom-module>