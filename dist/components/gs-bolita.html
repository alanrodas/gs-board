<dom-module id="gs-bolita">
  <template>
    <style>
      .container {
        margin: 1px;
        width: 18px;
        height: 18px;
        float: left;
      }
      .container .ball {
        width: 18px;
        height: 18px;
        display: block;
        border-radius: 9px;
        float: left;
        font-weight: bold;
      }
      .container .ball.black {
        background-color: #111;
        color: #FFF;
      }
      .container .ball.blue {
        background-color: #11F;
        color: #FFF;
      }
      .container .ball.red {
        background-color: #F11;
        color: #FFF;
      }
      .container .ball.green {
        background-color: #3F3;
        color: #000;
      }
      .container .ball.unknow {
        background-color: #888;
      }
      .container .ball * {
        box-sizing: content-box;
      }
      .container .ball .amount {
        cursor: default;
        display: flex;
        font-size: 16px;
        line-height: 18px;
        justify-content: center;
        align-items: center;
      }

    </style>

    <div class="container" title$="">
      <template is="dom-if" if="{{amount}}">
        <div class$="ball {{color}}">
            <span class="amount">{{amount}}</span>
        </div>
      </template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'gs-bolita',
      properties: {
        color: {
          type: String,
          value: 'unknow'
        },
        amount: {
          type: Number,
          value: 0,
          notify: true,
          observer: '_sanitize_amount'
        },
        editable: {
          type: Object,
          observer: '_editable_change'
        }
      },
      ready: function() {
        return this._sanitize_amount();
      },
      attached: function() {
        return this.editable && this._editable_change(true);
      },
      detached: function() {
        return this.editable && this._editable_change(false);
      },
      _editable_change: function(value) {
        if (value) {
          this.listen(this, 'tap', '_process_tap');
          return this.listen(this, 'contextmenu', '_right_click');
        } else {
          this.unlisten(this, 'tap', '_process_tap');
          return this.unlisten(this, 'contextmenu', '_right_click');
        }
      },
      _sanitize_amount: function() {
        if (!(typeof this.amount === 'number' && this.amount >= 0)) {
          return this.amount = 0;
        }
      },
      _process_tap: function(evnt) {
        return this.editable && (this.amount += 1);
      },
      _right_click: function(evnt) {
        if (this.editable) {
          evnt.preventDefault();
          return this.amount -= 1;
        }
      }
    });

  </script>
</dom-module>